# DolphinNext data processing pipeline for Worm Perturb-seq (WPS)
The pipeline is for the analysis of multiplexed bulk RNA-seq data in _C. elegans_; the barcode structure follows celSeq method. This pipeline includes modifications to for bulk RNA-seq data, and read count, instead of UMI count, was used as the expression level metric. The input are fastq files generated by bcl2fastq.

This repo includes a tutorial for both running the pipeline from the cloud (_Via Foundry_) or locally.

## Steps in the pipeline:

__1. extract valid reads by extractValidReads_UMIspecial2.py.__ This scripts extract R1 with valid cell barcode (allow 1 mismatch) and attach the cell barcode&UMI to the header of corresponding R2; Of note, we did NOT filter reads based on UMI quality because UMI is not used in quantifying expression levels for bulk RNA-seq. For details, refer to the Supplementary Methods of our paper. 
__2. standard Quality Control (QC) procedures of the reads quality.__ For QC, we use FastQC, Picard, RSEQC to create qc outputs.
__3. A STAR pipeline to align valid reads to the genome.__ This module includes Quality Control and Genome Alignment using STAR. Parameters were optimized for _C. elegans_ genome.
__4. A ESAT module to count reads for each feature.__ This step includes feature counting by ESAT and a wrapper script (cleanLowEndUmis_withRaw_forBulk.py) to convert the table formats. Please note that the file name (cleanLowEndUmis_withRaw_forBulk.py) was due to a historical reason and does not reflect the function of the script. No UMI cleaning operations were executed here. 

##### Inputs:

-   a) Paired Reads: output of Bcl2fastq software which has a structure as shown at below.

```
S1_L001_R1_001.fastq.gz
S1_L001_R2_001.fastq.gz
```

-   b) cellBarcodeFile: Valid Barcode File for valid cell barcode extraction.

```
s3://viafoundry/run_data/genome_data_other/CelSeq/bcSet_full.txt
```

##### Outputs:

_UMI table: The output file (`${name}_umi_count_.txt`) is tab separated gene/transcript vs cell_Barcode matrix filled with count data as shown at the example below.

   | gene  | ATCAATCGCGAACCGA | ACCCTCAACTCAAACA | ACTCATACCCGGAAAT |
   |-------|------------------|------------------|------------------|
   | RNF14 | 0                | 0                | 0                |
   | MZT2B | 0                | 12               | 0                |
   | SPN   | 0                | 2                | 8                |
		



##### Containers:

-   Docker: quay.io/viascientific/singlecell_esat:2.0

##### Run through Via Foundry User Interface:

To start using the CelSeq Pipeline please go to <a href="https://www.viafoundry.com/pipeline/355" target="_blank">Foundry Web page</a>
 and click run button.

##### Run through Command Line:

To install and start using the CelSeq pipeline by using command line, please follow these steps: [_Installation_](https://github.com/ViaScientific/cellSeq_Pipeline/blob/main/docs/local.md).

##### Citation:

If you use Foundry in your research, please cite:
Yukselen, O., Turkyilmaz, O., Ozturk, A.R. et al. DolphinNext: a distributed data processing platform for high throughput genomics. BMC Genomics 21, 310 (2020). https://doi.org/10.1186/s12864-020-6714-x
